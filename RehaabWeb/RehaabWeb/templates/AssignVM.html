{% extends 'main.html' %}
{% load static %}
{% load i18n %}
    
{% block content %}

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Assign vehicle managers</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'RehaabWeb/style.css' %}">
	<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.20/dist/sweetalert2.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.20/dist/sweetalert2.min.js"></script>


	<style>

  


		.table-responsive {
			margin: 20px;
			display: flex;
  			justify-content: center;
 			align-items: center;
			margin-left: 60px;
			
		}

		.table-wrapper {
			background: #fff;
			padding: 20px 25px;
			border-radius: 3px;
			min-width: 1000px;
			box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
		}

		.table-title {
			padding-bottom: 15px;
			background: #3d6449;
			color: #fff;
			padding: 16px 30px;
			min-width: 100%;
			margin: -20px -25px 30px;
			border-radius: 3px 3px 0 0;
		}

		.table-title h2 {
			margin: 5px 0 0;
			font-size: 24px;
			color: whitesmoke;
			text-align: left;
		}

		.table-title .btn-group {
			float: right;
		}

		.table-title .btn {
			color: #fff;
			float: right;
			font-size: 13px;
			border: none;
			min-width: 50px;
			border-radius: 2px;
			border: none;
			outline: none !important;
			margin-left: 10px;
		}

		.table-title .btn i {
			float: left;
			font-size: 21px;
			margin-right: 5px;
		}

		.table-title .btn span {
			float: left;
			margin-top: 2px;
		}

		table.table tr th,
		table.table tr td {
			border-color: #e9e9e9;
			padding: 12px 15px;
			vertical-align: middle;
		}

		table.table tr th:first-child {
			width: 60px;
		}

		table.table tr th:last-child {
			width: 100px;
		}

		table.table-striped tbody tr:nth-of-type(odd) {
			background-color: #fcfcfc;
		}

		table.table-striped.table-hover tbody tr:hover {
			background: #f5f5f5;
		}

		table.table th i {
			font-size: 13px;
			margin: 0 5px;
			cursor: pointer;
		}

		table.table td:last-child i {
			opacity: 0.9;
			font-size: 22px;
			margin: 0 5px;
		}

		table.table td a {
			font-weight: bold;
			display: inline-block;
			text-decoration: none;
			outline: none !important;
		}


		table.table td a.edit {
			color: #FFC107;
		}

		table.table td a.delete {
			color: #F44336;
		}

		table.table td i {
			font-size: 19px;
		}

		table.table .avatar {
			border-radius: 50%;
			vertical-align: middle;
			margin-right: 10px;
		}

		.pagination {
			float: right;
			margin: 0 0 5px;
		}

		.pagination li a {
			border: none;
			font-size: 13px;
			min-width: 30px;
			min-height: 30px;
			color: #999;
			margin: 0 2px;
			line-height: 30px;
			border-radius: 2px !important;
			text-align: center;
			padding: 0 6px;
		}

		.pagination li a:hover {
			color: #666;
		}





		.pagination li.disabled i {
			color: #ccc;
		}

		.pagination li i {
			font-size: 16px;
			padding-top: 6px
		}

		.hint-text {
			float: left;
			margin-top: 10px;
			font-size: 13px;
		}

		/* Custom checkbox */
		.custom-checkbox {
			position: relative;
		}

		.custom-checkbox input[type="checkbox"] {
			opacity: 0;
			position: absolute;
			margin: 5px 0 0 3px;
			z-index: 9;
		}

		.custom-checkbox label:before {
			width: 18px;
			height: 18px;
		}

		.custom-checkbox label:before {
			content: '';
			margin-right: 10px;
			display: inline-block;
			vertical-align: text-top;
			background: white;
			border: 1px solid #bbb;
			border-radius: 2px;
			box-sizing: border-box;
			z-index: 2;
		}

		.custom-checkbox input[type="checkbox"]:checked+label:after {
			content: '';
			position: absolute;
			left: 6px;
			top: 3px;
			width: 6px;
			height: 11px;
			border: solid #000;
			border-width: 0 3px 3px 0;
			transform: inherit;
			z-index: 3;
			transform: rotateZ(45deg);
		}


		.custom-checkbox input[type="checkbox"]:checked+label:after {
			border-color: #fff;
		}

		.custom-checkbox input[type="checkbox"]:disabled+label:before {
			color: #b8b8b8;
			cursor: auto;
			box-shadow: none;
			background: #ddd;
		}

		/* Modal styles */
		.modal .modal-dialog {
			max-width: 400px;
		}

		.modal .modal-header,
		.modal .modal-body,
		.modal .modal-footer {
			padding: 20px 45px;
			
		}

		.modal .modal-content {
			border-radius: 3px;
			font-size: 14px;
			color: black;
			font-weight: bold;
			
		}

		.modal-footer {
			background: #ffffff;
			border-radius: 0 0 3px 3px;
			max-height: 80px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.modal .modal-title {
			display: inline-block;
		}

		.modal .form-control {
			border-radius: 2px;
			box-shadow: none;
			border-color: #dddddd;
		}

		.modal textarea.form-control {
			resize: vertical;
		}

		.modal .btn {
			border-radius: 2px;
			max-width: 100px;
		}

		.modal form label {
			font-weight: normal;
		}
	
	
		.modal-body .btn-success{
		background-color: #3d6449; 
		color: #fff; 
		font-size: 16px; 
		margin: 40px;
		padding: 10px 20px;
		border-style: none;
		}
		.modal-body .btn-default{
		background-color: red; 
		color: #fff; 
		font-size: 16px; 
		margin: 30px;
		padding: 10px 20px;
		border-style: none;
		}
		.modal-body .btn-info{
		background-color: #3d6449; 
		color: #fff; 
		font-size: 16px; 
		margin: 30px;
		padding: 10px 20px;
		border-style: none;
		}
		.modal-body .btn-danger{
		background-color: #FFC107; 
		color: #fff; 
		font-size: 16px; 
		margin: 30px;
		padding: 10px 20px;
		border-style: none;
		}
		
		.modal-body .btn-default:hover {
 		 background-color: darkred; 
			}
		.modal-body .btn-success:hover {
  		background-color: #2d503b;
		}

		.modal-body .btn-info:hover {
		background-color: #2d503b; 
		}

		.modal-body .btn-danger:hover {
		background-color: #e0a800; 
		}
		.alert-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 9999;
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
	
	

	</style>

	<script>
		$(document).ready(function () {

			$('[data-toggle="tooltip"]').tooltip();
			var checkbox = $('table tbody input[type="checkbox"]');
			$("#selectAll").click(function () {
				if (this.checked) {
					checkbox.each(function () {
						this.checked = true;
					});
				} else {
					checkbox.each(function () {
						this.checked = false;
					});
				}
			});
			checkbox.click(function () {
				if (!this.checked) {
					$("#selectAll").prop("checked", false);
				}
			});
		});

		setTimeout(function(){
        if ($('#msg').length>0){
          $('#msg').remove();
        }
      }, 3000)
	</script>


		
{% if messages %}
{% for message in messages %}
<div class="alert-container" id="msg"  >
	<div class="alert {{ message.tags }} m-2" role="alert"> 
		{{message}}
	</div>
</div>
{% endfor %}
{% endif %}
	
	{% comment %} <div class="fixed left-0 top-0 w-64 h-full bg-green p-4 z-50 sidebar-menu transition-transform">
        <a href="#" class="flex items-center pb-4 border-b border-b-gray-800">
            {%block logo%}
            <img src="{% static 'RehaabWeb/greenRehaabLogo.png' %}" alt="" class="w-8 h-8 rounded object-cover">
            {% endblock %}

            <span class="text-lg font-bold text-white ml-3">Rehaab</span>
        </a>
        <ul class="sidebar-menu">
            <li class="mb-1 group ">
                <a href="{% url 'index' %}"
                    class="flex items-center py-2 px-4 text-gray-300 hover:bg-gray-950 hover:text-gray-100 rounded-md group-[.active]:bg-gray-800 group-[.active]:text-white group-[.selected]:bg-gray-950 group-[.selected]:text-gray-100">
                    <i class="ri-home-2-line mr-3 text-lg"></i>
                    <span class="text-sm">Dashboard</span>
                </a>
            </li>

            <li class="mb-1 group">
                <a href="{% url 'UpdateParameters' %}"
                    class="flex items-center py-2 px-4 text-gray-300 hover:bg-gray-950 hover:text-gray-100 rounded-md group-[.active]:bg-gray-800 group-[.active]:text-white group-[.selected]:bg-gray-950 group-[.selected]:text-gray-100">
                    <i class="ri-instance-line mr-3 text-lg"></i>
                    <span class="text-sm">Configure and Update</span>
                </a>
            </li>
            <li class="mb-1 group">
                <a href="{% url 'AssignVM' %}"
                    class="flex items-center py-2 px-4 text-gray-300 hover:bg-gray-950 hover:text-gray-100 rounded-md group-[.active]:bg-gray-800 group-[.active]:text-white group-[.selected]:bg-gray-950 group-[.selected]:text-gray-100">
                    <i class="ri-settings-2-line mr-3 text-lg"></i>
                    <span class="text-sm">Assign vehicle managers</span>
                </a>
            </li>
			<li class="mb-1 group">
                <a href="{% url 'sign-in' %}"
                    class="flex items-center py-2 px-4 text-gray-300 hover:bg-gray-950 hover:text-gray-100 rounded-md group-[.active]:bg-gray-800 group-[.active]:text-white group-[.selected]:bg-gray-950 group-[.selected]:text-gray-100">
                    <i class="ri-logout-box-line mr-3 text-lg"></i>
                    <span class="text-sm">Log out</span>
                </a>
            </li>
        </ul>
    </div>
    <div class="fixed top-0 left-0 w-full h-full bg-black/50 z-40 md:hidden sidebar-overlay"></div>
    <!-- end: Sidebar --> {% endcomment %}
	<main class="">

		<div class="container-xl">
			<div class="table-responsive">
				<div class="table-wrapper">
					<div class="table-title">
						<div class="row">
							<div class="col-sm-6">
								<h2>Manage <b>Employees</b></h2>
							</div>
							<div class="col-sm-6">
								<a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i
										class="material-icons">&#xE147;</i> <span>Add New Employee</span></a>
				
							</div>
						</div>
					</div>
					<table class="table table-striped table-hover">
						<thead>
							<tr>
								
								<th>Id</th>
								<th>Full name</th>
								<th>Email</th>
								<th>Task</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for employee in employees %}
							<tr >
								
								<td> {{employee.userID}}</td>
								<td>{{ employee.FullName }}</td>
								<td>{{ employee.Email }}</td>
								<td>{{ employee.Type }}</td>
								

								<td>
									<a class="edit" onclick="javascript:editRecored2('{{ employee.userID  }}');"><i
											class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
											
								
									<a href="#deleteVM" class="delete" onclick="javascript:deleteRecored('{{ employee.userID }}');" >
										<i
										class="material-icons" data-toggle="tooltip" title="Delete"  >&#xE872;</i>
									</a>

							


						
								</td>
							</tr>
							  {% endfor %}


						</tbody>
					</table>

				</div>
			</div>
		</div>
		<!-- add Modal HTML -->
		<div id="addEmployeeModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<form method="POST" action="{% url 'AssignVM' %}" id="addForm">
						{% csrf_token %}
						<input type="hidden" name="pk" id="id_userID"/>

						<div class="modal-header">
							<h4 class="modal-title" id="modalTitle">Add Employee</h4>
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						</div>
						<div class="modal-body">
							<div class="form-group">
								<label>Full name</label>
								<input type="text" class="form-control" name="fullName" id="id_FullName" required>
							</div>
							<div class="form-group">
								<label>Email</label>
								<input type="email" class="form-control" name="email" id="id_Email" required>
							</div>
							<div class="form-group" id="idPpasseordDiv">
								<label>Password</label>
								<input type="password" class="form-control" name="password" id="id_Password"  required>
								<small id="passwordHelp" class="form-text text-muted"></small>
							</div>
							<div class="form-group">
								<label>Task</label>
								<input type="text" class="form-control" name="task" id="id_Type" required>
								<input type="submit" class="btn btn-success" value="Add" id="addBTN">
								<input type="button" class="btn btn-success" value="Save" id="updateBTN" style="display: none;">
								<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
								
								
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
			$("#addEmployeeModal").on('hidden.bs.modal', function () {

				$("#idPpasseordDiv").show()
				$("#addForm")[0].reset()				
				$("#id_userID").val('')			
				$("#updateBTN").hide()
				$("#addBTN").show()	
				$("#modalTitle").html("Add Employee")	
				
			})
            $('#addForm').on('submit', function(e) {
                e.preventDefault();
                
                var form = $(this);
                var url = form.attr('action');
                var method = form.attr('method');
                function alert_message(msg="",icon="success",timer=2000){
				Swal.fire({
					position:'center',
					showConfirmButton:false,
					icon:icon,
					title:msg,
					timer: timer,
				})
			}
                $.ajax({

                    url: url,
                    method: method,
                    data: form.serialize(),
                    success: function(response) {
                        if (response.status === '1') {
                            
			alert_message(response.msg)
			setTimeout(function() {
							location.reload();
                        }, 2000);

                        } else if (response.status === '2') {
							
                            alert_message(response.msg,"error"); 
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(error);
                    }
                });
            });
        });

		document.addEventListener("DOMContentLoaded", function() {
				const passwordInput = document.getElementById("id_Password");
				const passwordHelp = document.getElementById("passwordHelp");
				const addButton = document.querySelector('input[type="submit"]');
		
				passwordInput.addEventListener("input", function() {
					const password = passwordInput.value;
					const passwordValidity = checkPasswordValidity(password);
					passwordHelp.textContent = passwordValidity;
		
					if (passwordValidity === "Password is valid.") {
						addButton.disabled = false; 
					} else {
						addButton.disabled = true; 
					}
				});
		
				function checkPasswordValidity(password) {
					const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/;
		
					if (password.match(passwordRegex)) {
						passwordHelp.style.color = "green";
						return "Password is valid.";
					} else {
						passwordHelp.style.color = "red";
						return "Password must be at least 8 characters long and contain at least one digit, one lowercase letter, one uppercase letter, and one special character.";
					}
				}
			});
    </script>
	

	\
		<script>
			
	
			$(document).on("click", "#updateBTN", function () {
		var formData = new FormData($("#addForm")[0]);
		formData.append('update', true);
		$.ajax({
			method: "post",
			contentType: false,
			processData: false,
			data: formData,
			beforeSend: function (xhr) {
				xhr.setRequestHeader(
				"X-CSRFToken",
				$("input[name=csrfmiddlewaretoken]").val()
				);
			},
		
			success: function (data) {
				if (data.status == "1") {
					alert_message(data.msg);
                        setTimeout(function() {
							location.reload();
                        }, 600); 
						
				} 
				
				else if (data.status == "2") {
				alert_message(data.msg, "error");
				} 
				else {
					
				
				}
			},
			error: function (xhr, status, error) {
				console.error(error);
			},
		});
	});
	
			function editRecored2(ID){
				var id = ID;
				
				$("#modalTitle").html("Edit Employee")	
				$('#addEmployeeModal').modal('show')
				$("#idPpasseordDiv").hide()
				$.ajax({
					method:"get",
					data:{"id":id,"edite":true},
					success:function(data){
						console.log(data)
						if(data.status == "1"){
							$("#updateBTN").show()
							$("#addBTN").hide()
							data = JSON.parse(data.data)
							
							console.log(data)
							$(`input[name='pk']`).val(data[0].pk)
							$.each(data[0].fields,function(k, v){
								
								$(`#id_${k}`).val(v)
								
							})
							
							
						   
						}else{
							alert(data.message)
						}
					},
					complete: function() {
					   
					},
					error:function(){
		  
					},

					
				}) 
		  
			}

			setTimeout(function(){
			  if ($('#msg').length>0){
				$('#msg').remove();
			  }
			}, 3000)
			function alert_message(msg="",icon="success",timer=600){
				Swal.fire({
					position:'center',
					showConfirmButton:false,
					icon:icon,
					title:msg,
					timer: timer,
				})
			}

			function deleteRecored(recoredId){
				id = recoredId;
				msg="Are You Sure Want to Delete This Vehicle Manager?"
				title=""
				Swal.fire({
					title: msg,
					text: title,
					icon: 'warning',        
					confirmButtonColor: '#3d6449' ,
					cancelButtonColor: '#F44336',
					cancelButtonText: 'No',
					confirmButtonText: 'Yes',
					showCloseButton: true,
					showCancelButton: true,
				}).then((result) => {
					if (result.isConfirmed) {
						$.ajax({
							method:"DELETE",
							data:{'id':id,'delete':'true'},
							beforeSend:function(xhr){
								xhr.setRequestHeader("X-CSRFToken",$('input[name=csrfmiddlewaretoken]').val());
							},
							success:function(data){
								alert_message(data.msg,'success')
								setTimeout(function() {
							location.reload();
                        }, 600);
										
							},
							error:function(){
					
							}
						})
					}
					else{
						
					}
				})
				
			}
			function editRecored(recoredId,recoredname,recoredemil,recoredtask){
				id = recoredId;

val.
				title=""
				Swal.fire({
					title: msg,
					text: title,
					icon: 'warning',        
					confirmButtonColor: '#3d6449' ,
					cancelButtonColor: '#F44336',
					cancelButtonText: 'No',
					confirmButtonText: 'Yes',
					showCloseButton: true,
					showCancelButton: true,
				}).then((result) => {
					if (result.isConfirmed) {
						$.ajax({
							method:"DELETE",
							data:{'id':id,'delete':'true'},
							beforeSend:function(xhr){
								xhr.setRequestHeader("X-CSRFToken",$('input[name=csrfmiddlewaretoken]').val());
							},
							success:function(data){
								alert_message(data.msg,'success')
										
							},
							error:function(){
					
							}
						})
					}
					else{
						
					}
				})
				
			}


</script>

		</script>
		<script src="{% static 'RehaabWeb/script.js' %}"></script>
		{% endblock %}
